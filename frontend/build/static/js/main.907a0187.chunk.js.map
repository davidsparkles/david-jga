{"version":3,"sources":["model/permissionReducer.ts","model/store.ts","api/useData.ts","api/usePostQuest.ts","model/hooks.ts","components/QuestDetails.tsx","components/Quests.tsx","components/GameHeader.tsx","components/GameFooter.tsx","utils/http.ts","push-notifications.ts","usePushNotifications.ts","components/Levels.tsx","api/usePostLevels.ts","components/Rewards.tsx","components/Settings.tsx","components/Game.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["permissionSlice","createSlice","name","initialState","token","permission","reducers","changeToken","state","action","payload","console","log","Cookies","set","sameSite","expires","actions","selectToken","selectPermission","store","configureStore","reducer","permissionReducer","getData","a","fetch","res","status","json","error","statusText","text","Error","usePostQuest","useState","loading","setLoading","setError","post","useCallback","values","window","location","hostname","method","mode","cache","credentials","headers","referrerPolicy","body","JSON","stringify","useAppDispatch","useDispatch","useAppSelector","useSelector","QuestDetails","props","quest","onBack","title","description","maxXp","minLevel","xp","disabled","archived","setValues","useEffect","onSave","id","onDelete","delete","className","onClick","value","onChange","evt","target","rows","type","parseInt","checked","versions","map","created_at","fields","Intl","DateTimeFormat","format","Date","substring","max_xp","min_level","Quests","get","filterList","setFilterList","filterArchivedList","setFilterArchivedList","selectedQuest","setSelectedQuest","refetch","quests","filter","index","formatDescription","style","display","gridTemplateColumns","Notification","setTimeout","requestPermission","then","alert","remove","length","GameHeader","data","currentLevel","maxLevel","Progress","current","xpWithinCurrentLevel","max","xpToNextLevel","ratio","width","GameFooter","undefined","to","pathname","search","http","path","response","pushServerPublicKey","navigator","serviceWorker","ready","pushManager","subscribe","userVisibleOnly","applicationServerKey","pushNotificationSupported","usePushNotifications","userConsent","setUserConsent","userSubscription","setUserSubscription","pushServerSubscriptionId","setPushServerSubscriptionId","register","getSubscription","pushSubscription","existingSubscription","getExixtingSubscription","onClickAskUserPermission","askUserPermission","consent","message","code","onClickSusbribeToPushNotification","createNotificationSubscription","subscrition","catch","err","onClickSendSubscriptionToPushServer","onClickSendNotification","Levels","levels","sort","b","requiredXp","deleteElement","i","changeElement","valueNew","valueBefore","diff","usePostLevels","Rewards","Settings","dispatch","Loading","Game","setData","useData","pushLoading","pushError","exact","component","App","URLSearchParams","warn","getPermissionTokenFromUrlOrCookie","onTouchMove","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.907a0187.chunk.js","sourcesContent":["import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\nimport Cookies from \"js-cookie\";\nimport type { RootState } from \"./store\";\n\nexport type Permission = \"none\" | \"view\" | \"edit\";\n\ninterface PermissionState {\n  token: string;\n  permission: Permission\n}\n\n// Define the initial state using that type\nconst initialState: PermissionState = {\n  token: \"\",\n  permission: \"none\"\n}\n\nconst EDIT_TOKEN = \"broiler\";\nconst VIEW_TOKEN = \"fittie\";\n\nexport const permissionSlice = createSlice({\n  name: \"permission\",\n  // `createSlice` will infer the state type from the `initialState` argument\n  initialState,\n  reducers: {\n    changeToken: (state, action: PayloadAction<string>) => {\n      const token = action.payload;\n      state.token = token;\n\n      console.log(\"change cookie to\", token);\n      Cookies.set(\"token\", token, { sameSite: \"lax\", expires: 30 });\n\n      switch (token) {\n        case EDIT_TOKEN:\n          state.permission = \"edit\";\n          break;\n        case VIEW_TOKEN:\n          state.permission = \"view\";\n          break;\n        default:\n          state.permission = \"none\";\n          break;\n      }\n    }\n  }\n})\n\nexport const { changeToken } = permissionSlice.actions;\n\nexport const selectToken = (state: RootState) => state.permission.token;\nexport const selectPermission = (state: RootState) => state.permission.permission;\n\nexport default permissionSlice.reducer;\n","import { configureStore } from \"@reduxjs/toolkit\"\nimport permissionReducer from \"./permissionReducer\";\n// import rewardsReducer from \"./rewardsReducer\";\n// import questsReducer from \"./questsReducer\";\n\nconst store = configureStore({\n  reducer: {\n    // quests: permissionReducer,\n    // rewards: rewardsReducer,\n    permission: permissionReducer\n  }\n});\n\nexport type RootState = ReturnType<typeof store.getState>\nexport type AppDispatch = typeof store.dispatch\n\nexport default store;\n","import { useCallback, useEffect, useState } from \"react\";\n\nexport type questState = \"open\" | \"closed\" | \"hidden\";\n\nexport interface Quest {\n  id: string;\n  title: string;\n  description: string;\n  maxXp: number;\n  xp: number | null;\n  minLevel: number;\n  disabled: boolean;\n  archived: boolean;\n  state: questState;\n  versions?: Version[];\n}\n\nexport interface Version {\n  id: number;\n  quest_id: number;\n  created_at: string;\n  fields: any;\n}\n\nexport interface Level {\n  id: number;\n  requiredXp: number;\n}\n\nexport interface Data {\n  maxLevel: number;\n  currentLevel: number;\n  currentXp: number;\n  xpWithinCurrentLevel: number;\n  xpToNextLevel: number;\n  quests: Quest[];\n  levels: Level[];\n}\n\nasync function getData(): Promise<Data> {\n  const res = await fetch(\"/api/data\");\n  if (res.status === 200) return res.json();\n  console.error(`Fetch error: ${res.status} ${res.statusText} ${res.text()}`);\n  throw new Error(res.statusText);\n}\n\nexport function useData(): { data?: Data; error?: any; loading: boolean; refetch: () => void } {\n  const [loading, setLoading] = useState<boolean>(false);\n  const [data, setData] = useState<Data | undefined>(undefined);\n  const [error, setError] = useState<any | undefined>(undefined);\n\n  const refetch = useCallback(() => {\n    (async () => {\n      try {\n        setLoading(true);\n        setData(await getData());\n        setError(undefined);\n      } catch (err) {\n        console.log(err);\n        setData(undefined);\n        setError(\"Upps ein Fehler ist aufgetreten.\");\n      } finally {\n        setLoading(false);\n      }\n    })();\n  }, []);\n\n  useEffect(refetch, [refetch]);\n\n  return { data, error, loading, refetch };\n}\n","import { useCallback, useState } from \"react\";\n\ninterface Values {\n  id?: string;\n  title: string;\n  description: string;\n  maxXp: number;\n  minLevel: number;\n  disabled: boolean;\n  archived: boolean;\n}\n\nexport function usePostQuest() {\n  const [loading, setLoading] = useState<boolean>(false);\n  const [error, setError] = useState<any | null>(null);\n\n  const post = useCallback(async (values: Values | { delete: true; id: string }) => {\n    try {\n      setLoading(true);\n      await fetch(`${window.location.hostname === \"localhost\" ? \"http://localhost:3000\" : \"\"}/api/quest`, {\n        method: \"POST\",\n        mode: \"no-cors\",\n        cache: 'no-cache',\n        credentials: \"same-origin\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        referrerPolicy: 'no-referrer',\n        body: JSON.stringify(values)\n      })\n    } catch (err) {\n      setError(err);\n    } finally {\n      setLoading(false);\n    }\n  }, [setError, setLoading]);\n\n  return { loading, error, post };\n}\n","import { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'\nimport type { RootState, AppDispatch } from './store'\n\nexport const useAppDispatch = () => useDispatch<AppDispatch>();\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport { BiArrowBack } from \"react-icons/bi\";\nimport { Quest } from \"../api/useData\";\nimport { usePostQuest } from \"../api/usePostQuest\";\nimport { useAppSelector } from \"../model/hooks\";\nimport { selectPermission } from \"../model/permissionReducer\";\nimport \"./QuestDetails.css\";\n\ninterface Values {\n  title: string;\n  description: string;\n  maxXp: number;\n  minLevel: number;\n  xp: number | null;\n  disabled: boolean;\n  archived: boolean;\n}\n\nexport default function QuestDetails(props: { quest: Quest; onBack: () => void }): JSX.Element {\n  const { quest, onBack } = props;\n  const permission = useAppSelector(selectPermission);\n\n  const [values, setValues] = useState<Values>({ title: \"\", description: \"\", maxXp: 0, minLevel: 0, xp: null, disabled: false, archived: false });\n\n  const { loading, error, post } = usePostQuest();\n\n  useEffect(() => {\n    if (quest != null) {\n      setValues({\n        title: quest.title ?? \"\",\n        description: quest.description ?? \"\",\n        maxXp: quest.maxXp,\n        minLevel: quest.minLevel,\n        xp: quest.xp,\n        disabled: quest.disabled ?? false,\n        archived: quest.archived ?? false\n      })\n    }\n  }, [quest]);\n\n  const onSave = useCallback(async () => {\n    await post({ id: quest.id, ...values });\n    onBack();\n  }, [onBack, post, quest, values]);\n\n  const onDelete = useCallback(async () => {\n    await post({ delete: true, id: quest.id });\n    onBack();\n  }, [onBack, post, quest]);\n\n  return <div className=\"questDetails\">\n    <div className=\"backArrowContainer\" >\n      <BiArrowBack className=\"backArrow\" onClick={() => onBack()} />\n      <div className=\"value\">\n        {\n          permission === \"edit\"\n          ?\n          (<input value={values.title} onChange={(evt) => setValues({ ...values, title: evt.target.value })} />)\n          :\n          quest.title ?? \"-\"\n        }\n      </div>\n    </div>\n    <div className=\"label\">\n      Beschreibung\n    </div>\n    <div className=\"value\">\n      {\n        permission === \"edit\"\n        ?\n        (<textarea rows={10} value={values.description} onChange={(evt) => setValues({ ...values, description: evt.target.value })} />)\n        :\n        quest.description ?? \"-\"\n      }\n    </div>\n    <div className=\"label\">\n      Mindestens Level\n    </div>\n    <div className=\"value\">\n      {\n        permission === \"edit\"\n        ?\n        (<input type=\"number\" value={values.minLevel} onChange={(evt) => setValues({ ...values, minLevel: parseInt(evt.target.value, 10) })} />)\n        :\n        quest.minLevel\n      }\n    </div>\n    <div className=\"label\">\n      Maximale XP\n    </div>\n    <div className=\"value\">\n      {\n        permission === \"edit\"\n        ?\n        (<input type=\"number\" value={values.maxXp} onChange={(evt) => setValues({ ...values, maxXp: parseInt(evt.target.value, 10) })} />)\n        :\n        quest.maxXp\n      }\n    </div>\n    <div className=\"label\">\n      Erreichte XP\n    </div>\n    <div className=\"value\">\n      {\n        permission === \"edit\"\n        ?\n        (<input type=\"number\" value={values.xp ?? \"-\"} onChange={(evt) => {\n          const xp = parseInt(evt.target.value, 10);\n          setValues({ ...values, xp: xp < 0 ? null : xp })\n        }} />)\n        :\n        quest.state !== \"closed\" ? \"-\" : quest.xp\n      }\n    </div>\n    {\n      permission === \"edit\" && (\n        <>\n          <div className=\"label\">\n            Versteckt\n          </div>\n          <div className=\"value\">\n            <input type=\"checkbox\" checked={values.disabled} onChange={(evt) => setValues({ ...values, disabled: evt.target.checked })} />\n          </div>\n          <div className=\"label\">\n            Archiviert\n          </div>\n          <div className=\"value\">\n            <input type=\"checkbox\" checked={values.archived} onChange={(evt) => setValues({ ...values, archived: evt.target.checked })} />\n          </div>\n        <div className=\"buttonContainer\">\n          <div className=\"saveContainer\">\n            <button onClick={onSave}>Speichern</button>\n          </div>\n          {quest.archived && (\n            <div className=\"deleteContainer\">\n              <button onClick={onDelete}>Quest löschen</button>\n            </div>\n          )}\n          {loading ?? <>loading...</>}\n          {error && <>{JSON.stringify(error)}</>}\n        </div>\n        <h4>Versionen</h4>\n        <div className=\"versionList\">\n          {quest.versions?.map(({ id, created_at, fields }) => (\n            <div className=\"versionItem\">\n              Version {id} vom {new Intl.DateTimeFormat(\"de\").format(new Date(created_at))} {created_at.substring(11, 19)}{\" \"}\n              <button onClick={() => setValues({ ...values, ...fields, maxXp: fields.max_xp, minLevel: fields.min_level })}>🔃</button>\n            </div>\n          ))}\n        </div>\n      </>\n    )}\n  </div>;\n}","import React, { useState } from \"react\";\nimport Cookies from \"js-cookie\";\nimport { Quest } from \"../api/useData\";\nimport { usePostQuest } from \"../api/usePostQuest\";\nimport { useAppSelector } from \"../model/hooks\";\nimport { selectPermission } from \"../model/permissionReducer\";\nimport QuestDetails from \"./QuestDetails\";\nimport \"./Quests.css\";\n\nexport default function Quests(props: { quests: Quest[]; refetch: () => void }): JSX.Element {\n  const permission = useAppSelector(selectPermission);\n\n  const [filterList, setFilterList] = useState<boolean>(Cookies.get(\"filterList\") != null ? Cookies.get(\"filterList\") === \"true\" : true);\n  const [filterArchivedList, setFilterArchivedList] = useState<boolean>(Cookies.get(\"filterArchivedList\") != null ? Cookies.get(\"filterArchivedList\") === \"true\" : false);\n  const [selectedQuest, setSelectedQuest] = useState<Quest | null>(null);\n\n  const { loading, error, post } = usePostQuest();\n\n  if (selectedQuest != null) {\n    return <QuestDetails quest={selectedQuest} onBack={() => { setSelectedQuest(null); props.refetch() }} />;\n  }\n\n  return (\n    <>\n    <div className=\"questList\">\n      <div className=\"questFilter\">\n        <input type=\"checkbox\" checked={filterList} onChange={(evt) => {\n          setFilterList(evt.target.checked);\n          Cookies.set(\"filterList\", `${evt.target.checked}`);\n        }} />Erledigte Quests\n      </div>\n      {permission === \"edit\" && (\n        <div className=\"questFilter\">\n          <input type=\"checkbox\" checked={filterArchivedList} onChange={(evt) => {\n            setFilterArchivedList(evt.target.checked);\n            Cookies.set(\"filterArchivedList\", `${evt.target.checked}`);\n          }} />Archivierte Quests\n        </div>\n      )}\n      {props.quests\n        .filter(({ state }) => filterList === true ? true : state !== \"closed\")\n        .filter(({ archived }) => filterArchivedList === true ? true : archived === false)\n        .filter(({ archived, disabled }) => (archived === false && disabled === false) || permission === \"edit\")\n        .map((quest, index) => (\n          <div\n            key={index}\n            className={`questBox ${quest.state} ${quest.disabled ? \"disabled\" : \"\"} ${quest.archived ? \"archived\" : \"\"}`}\n            onClick={() => !(permission === \"none\" && quest.state === \"hidden\") && setSelectedQuest(quest)}\n          >\n            <div className=\"questHeader\">\n              <div className=\"questTitle\">{(permission === \"none\" && quest.state === \"hidden\") || quest.title == null ? \"🔒 ???\" : `${quest.state === \"hidden\" ? \"🔒 \" : \"\"}${quest.title}`}</div>\n              <div className=\"questPoints\">\n                {\n                  quest.state !== \"closed\" ? quest.maxXp : `${quest.xp} / ${quest.maxXp}`\n                } XP\n              </div>\n            </div>\n            {\n              !(permission === \"none\" && quest.state === \"hidden\") && <div className=\"questDescription\">{formatDescription(quest.description ?? \"???\")}</div>\n            }\n            {\n              quest.state === \"hidden\" && <div className=\"questDescription\">Ab Level {quest.minLevel}</div>\n            }\n          </div>\n      ))}\n    </div>\n    {permission === \"edit\" && (\n      <div style={{ display: \"grid\", gridTemplateColumns: \"auto auto auto\" }}>\n        <div className=\"createQuestContainer\">\n          <button onClick={async () => {\n            await post({ title: \"Neue Quest\", description: \"\", maxXp: 1, disabled: true, minLevel: 20, archived: false });\n            props.refetch();\n          }}>\n            Neue Quest\n          </button>\n        </div>\n        <div>\n          <button onClick={() => {\n            // Let's check if the browser supports notifications\n            if (!(\"Notification\" in window)) {\n              alert(\"This browser does not support desktop notification\");\n            }\n\n            // Let's check whether notification permissions have already been granted\n            else if (Notification.permission === \"granted\") {\n              // If it's okay let's create a notification\n              setTimeout(() => new Notification(\"Unlocked next level 2!\"), 3000);\n            }\n\n            // Otherwise, we need to ask the user for permission\n            else if (Notification.permission !== \"denied\") {\n              Notification.requestPermission().then(function (permission) {\n                // If the user accepts, let's create a notification\n                if (permission === \"granted\") {\n                  setTimeout(() => new Notification(\"Unlocked next level 2!\"), 3000);\n                }\n              });\n            }\n\n            // At last, if the user has denied notifications, and you\n            // want to be respectful there is no need to bother them any more.\n          }}>\n            Notify me in 3 secs!\n          </button>\n        </div>\n        <div>\n          <button onClick={() => {\n            Cookies.remove(\"token\");\n          }}>\n            Log Out!\n          </button>\n        </div>\n      </div>\n    )}\n    {loading && \"loading ...\"}\n    {error && <>Fehler: {JSON.stringify(error)}</>}\n    </>\n  );\n}\n\nfunction formatDescription(description?: string): string {\n  if (description == null) return \"???\";\n  if (description.length < 100) return description;\n  return description.substring(0, 96) + \" ...\";\n}\n","import React from \"react\";\nimport { Data } from \"../api/useData\";\nimport \"./GameHeader.css\";\n\nexport default function GameHeader(props: { data?: Data }): JSX.Element {\n  return (\n    <div className=\"gameHeader\">\n      <div className=\"gameHeaderTitle\">Quest Master</div>\n      <div className=\"gameHeaderLevel\">\n        Level {props.data?.currentLevel ?? 1} / {props.data?.maxLevel ?? \"?\"}\n      </div>\n      <Progress current={props.data?.xpWithinCurrentLevel ?? 0} max={(props.data?.xpToNextLevel ?? 0) + (props.data?.xpWithinCurrentLevel ?? 1)} />\n    </div>\n  );\n}\n\nfunction Progress(props: { max: number; current: number }): JSX.Element {\n  const ratio = 100 * props.current / props.max;\n\n  return (\n    <div className=\"gameProgressContainer\">\n      <div className=\"gameProgressBar\">\n        <div style={{ width: `${ratio}%` }} className=\"gameProgressCurrent\">\n          <div className=\"gameProgressCurrentText\">\n            {props.current}\n          </div>\n        </div>\n      </div>\n      {props.max}↑\n    </div>\n  )\n}\n","import React from \"react\";\nimport { Link, RouteChildrenProps } from \"react-router-dom\";\nimport { AiFillTrophy, AiFillSetting } from \"react-icons/ai\"\nimport { FaTasks } from \"react-icons/fa\"\nimport { RiFilePaper2Fill } from \"react-icons/ri\"\nimport { useAppSelector } from \"../model/hooks\";\nimport { selectPermission } from \"../model/permissionReducer\";\nimport \"./GameFooter.css\";\n\nexport default function GameFooter(props: RouteChildrenProps): JSX.Element {\n  const permission = useAppSelector(selectPermission);\n\n  return (\n    <div className=\"gameFooter\" style={permission === \"edit\" ? { gridTemplateColumns: \"auto auto auto auto\" } : undefined }>\n      <Link to={{ pathname: \"/quests\", search: props.location.search }}>\n        <FaTasks />\n      </Link>\n      <Link to={{ pathname: \"/rewards\", search: props.location.search }}>\n        <AiFillTrophy />\n      </Link>\n      {\n        permission === \"edit\" && (\n          <Link to={{ pathname: \"/levels\", search: props.location.search }}>\n            <RiFilePaper2Fill />\n          </Link>\n        )\n      }\n      <Link to={{ pathname: \"/settings\", search: props.location.search }}>\n        <AiFillSetting />\n      </Link>\n    </div>\n  );\n}\n","function post(path: string, body: any) {\n  return fetch(path, {\n    credentials: \"omit\",\n    headers: { \"content-type\": \"application/json;charset=UTF-8\", \"sec-fetch-mode\": \"cors\" },\n    body: JSON.stringify(body),\n    method: \"POST\",\n    mode: \"cors\"\n  })\n    .then(function(response) {\n      return response.json();\n    })\n    .then(function(data) {\n      return data;\n    });\n}\n\nfunction get(path: string) {\n  return fetch(path, {\n    credentials: \"omit\",\n    headers: { \"content-type\": \"application/json;charset=UTF-8\", \"sec-fetch-mode\": \"cors\" },\n    method: \"GET\",\n    mode: \"cors\"\n  })\n    .then(function(response) {\n      return response.json();\n    })\n    .then(function(data) {\n      return data;\n    });\n}\n\nconst http = {\n  post: post,\n  get: get\n};\n\nexport default http;\n","const pushServerPublicKey = \"BDTxsv_QJLLjMkKfKrZw9kLADmciH2_E1B4Smkp9kbOLHWlrNs_3jFZA3zCyYbw9GRKq5hoEhkcHiBMf8OiGKDQ\";\n\n/**\n * checks if Push notification and service workers are supported by your browser\n */\nfunction isPushNotificationSupported() {\n  return \"serviceWorker\" in navigator && \"PushManager\" in window;\n}\n\n/**\n * asks user consent to receive push notifications and returns the response of the user, one of granted, default, denied\n */\nasync function askUserPermission() {\n  return await Notification.requestPermission();\n}\n/**\n * shows a notification\n */\nfunction sendNotification() {\n  // const img = \"/images/jason-leung-HM6TMmevbZQ-unsplash.jpg\";\n  const text = \"Take a look at this brand new t-shirt!\";\n  const title = \"New Product Available\";\n  const options = {\n    body: text,\n    // icon: \"/images/jason-leung-HM6TMmevbZQ-unsplash.jpg\",\n    vibrate: [200, 100, 200],\n    tag: \"new-product\",\n    // image: img,\n    badge: \"https://spyna.it/icons/android-icon-192x192.png\",\n    actions: [{ action: \"Detail\", title: \"View\", icon: \"https://via.placeholder.com/128/ff0000\" }]\n  };\n  navigator.serviceWorker.ready.then(function(serviceWorker) {\n    serviceWorker.showNotification(title, options);\n  });\n}\n\n/**\n *\n */\nfunction registerServiceWorker() {\n  return navigator.serviceWorker.register(\"/sw.js\");\n}\n\n/**\n *\n * using the registered service worker creates a push notification subscription and returns it\n *\n */\nasync function createNotificationSubscription() {\n  //wait for service worker installation to be ready\n  const serviceWorker = await navigator.serviceWorker.ready;\n  // subscribe and return the subscription\n  return await serviceWorker.pushManager.subscribe({\n    userVisibleOnly: true,\n    applicationServerKey: pushServerPublicKey\n  });\n}\n\n/**\n * returns the subscription if present or nothing\n */\nfunction getUserSubscription(): Promise<PushSubscription | null> {\n  //wait for service worker installation to be ready, and then\n  return navigator.serviceWorker.ready\n    .then(function(serviceWorker) {\n      return serviceWorker.pushManager.getSubscription();\n    })\n    .then(function(pushSubscription) {\n      return pushSubscription;\n    });\n}\n\nexport {\n  isPushNotificationSupported,\n  askUserPermission,\n  registerServiceWorker,\n  sendNotification,\n  createNotificationSubscription,\n  getUserSubscription\n};","import { useState, useEffect, useCallback } from \"react\";\nimport http from \"./utils/http\";\n\n// https://itnext.io/react-push-notifications-with-hooks-d293d36f4836\n// https://github.com/Spyna/push-notification-demo\n\nimport {\n  isPushNotificationSupported,\n  askUserPermission,\n  registerServiceWorker,\n  createNotificationSubscription,\n  getUserSubscription\n} from \"./push-notifications\";\n\nconst pushNotificationSupported = isPushNotificationSupported();\n\nexport default function usePushNotifications() {\n  const [userConsent, setUserConsent] = useState(Notification.permission);\n  const [userSubscription, setUserSubscription] = useState<PushSubscription | null>(null);\n  const [pushServerSubscriptionId, setPushServerSubscriptionId] = useState();\n  const [error, setError] = useState<any | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (pushNotificationSupported) {\n      setLoading(true);\n      setError(false);\n      registerServiceWorker().then(() => {\n        setLoading(false);\n      });\n    }\n  }, []);\n  \n  useEffect(() => {\n    setLoading(true);\n    setError(false);\n    const getExixtingSubscription = async () => {\n      const existingSubscription = await getUserSubscription();\n      setUserSubscription(existingSubscription);\n      setLoading(false);\n    };\n    getExixtingSubscription();\n  }, []);\n\n  const onClickAskUserPermission = useCallback(() => {\n    setLoading(true);\n    setError(false);\n    return askUserPermission().then(consent => {\n      setUserConsent(consent);\n      if (consent !== \"granted\") {\n        setError({\n          name: \"Consent denied\",\n          message: \"You denied the consent to receive notifications\",\n          code: 0\n        });\n      }\n      setLoading(false);\n    });\n  }, [setLoading, setError, setUserConsent]);\n\n  const onClickSusbribeToPushNotification = useCallback(() => {\n    setLoading(true);\n    setError(false);\n    return createNotificationSubscription()\n      .then(function(subscrition) {\n        setUserSubscription(subscrition);\n        setLoading(false);\n      })\n      .catch(err => {\n        console.error(\"Couldn't create the notification subscription\", err, \"name:\", err.name, \"message:\", err.message, \"code:\", err.code);\n        setError(err);\n        setLoading(false);\n      });\n  }, [setLoading, setError, setUserSubscription]);\n\n  const onClickSendSubscriptionToPushServer = useCallback(() => {\n    if (userSubscription == null || userConsent !== \"granted\") {\n      console.log(\"No userSubscription present or consent not given\");\n      return;\n    }\n    setLoading(true);\n    setError(false);\n    http\n      .post(\"/api/subscription\", userSubscription)\n      .then((response: any) => {\n        setPushServerSubscriptionId(response.id);\n        setLoading(false);\n      })\n      .catch((err: any) => {\n        setLoading(false);\n        setError(err);\n      });\n  }, [userSubscription, userConsent, setLoading, setError, setPushServerSubscriptionId]);\n\n  const onClickSendNotification = useCallback(async () => {\n    setLoading(true);\n    setError(false);\n    await http\n      .get(`/api/subscription`)\n      .catch((err: any) => {\n        setLoading(false);\n        setError(err);\n      });\n    setLoading(false);\n  }, [setLoading, setError]);\n\n  return {\n    onClickAskUserPermission,\n    onClickSusbribeToPushNotification,\n    onClickSendSubscriptionToPushServer,\n    pushServerSubscriptionId,\n    onClickSendNotification,\n    userConsent,\n    pushNotificationSupported,\n    userSubscription,\n    error,\n    loading\n  };\n}\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport { Level } from \"../api/useData\";\nimport { usePostLevels } from \"../api/usePostLevels\";\nimport \"./Levels.css\";\n\nexport default function Levels(props: { levels: Level[] }): JSX.Element {\n  const [values, setValues] = useState<number[]>([]);\n\n  useEffect(() => {\n    setValues(props.levels.sort((a, b) => a.id - b.id).map(({ requiredXp }) => requiredXp));\n  }, [props.levels]);\n\n  const deleteElement = useCallback((i: number) => {\n    if (i < 0 || i >= values.length) return;\n    setValues(values.filter((value, index) => index !== i));\n  }, [values, setValues]);\n\n  const changeElement = useCallback((i: number, valueNew: number) => {\n    if (i < 0 || i >= values.length || valueNew < 0) return;\n    const valueBefore = values[i - 1];\n    if (valueBefore != null && valueBefore >= valueNew) return;\n    const valueCurrent = values[i];\n    const diff = valueNew - valueCurrent;\n    setValues(values.map((value, index) => i <= index ? value + diff : value));\n  }, [values, setValues]);\n\n  const { loading, error, post } = usePostLevels();\n\n  return (\n    <div className=\"levels\">\n      <b>Levels</b>\n      {values.map((requiredXp, index) => (\n        <div className=\"levelsContainer\">\n          <div className=\"levelIndex\">{index + 1}</div>\n          <div className=\"levelXp\">\n            <input type=\"number\" value={requiredXp} onChange={(evt) => changeElement(index, parseInt(evt.target.value, 10))} />\n          </div>\n          <div className=\"levelDelete\">\n            <button onClick={() => deleteElement(index)}>Löschen</button>\n          </div>\n        </div>\n      ))}\n      <button className=\"levelAdd\" onClick={() => setValues([...values, values[values.length - 1] + 1])}>Neues Level</button>\n      <br />\n      <button className=\"levelsSave\" onClick={() => post(values.map((value, index) => ({ id: index + 1, requiredXp: value })))}>Speichern</button>\n      {loading && <>loading...</>}\n      {error && <>Error: {JSON.stringify(error)}</>}\n    </div>\n  );\n}","import { useCallback, useState } from \"react\";\nimport { Level } from \"./useData\";\n\nexport function usePostLevels() {\n  const [loading, setLoading] = useState<boolean>(false);\n  const [error, setError] = useState<any | null>(null);\n\n  const post = useCallback(async (levels: Level[]) => {\n    try {\n      setLoading(true);\n      await fetch(`${window.location.hostname === \"localhost\" ? \"http://localhost:3000\" : \"\"}/api/levels`, {\n        method: \"POST\",\n        mode: \"no-cors\",\n        cache: 'no-cache',\n        credentials: \"same-origin\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        referrerPolicy: 'no-referrer',\n        body: JSON.stringify(levels)\n      })\n    } catch (err) {\n      setError(err);\n    } finally {\n      setLoading(false);\n    }\n  }, [setError, setLoading]);\n\n  return { loading, error, post };\n}\n","import React from \"react\";\nimport { useAppSelector } from \"../model/hooks\";\nimport { selectPermission } from \"../model/permissionReducer\";\n\nexport default function Rewards(props: { refetch: () => void }): JSX.Element {\n  const permission = useAppSelector(selectPermission);\n\n  return <>Belohnungen: todo. Permission <i>{permission}</i></>;\n}\n","import React from \"react\";\nimport { useAppSelector, useAppDispatch } from \"../model/hooks\";\nimport { selectToken, selectPermission, changeToken } from \"../model/permissionReducer\";\n\nexport default function Settings(props: {\n  userConsent: \"default\" | \"denied\" | \"granted\";\n  onClickAskUserPermission: () => Promise<void>;\n  onClickSusbribeToPushNotification: () => Promise<void>;\n  onClickSendNotification: () => Promise<void>;\n  loading: boolean;\n  error: any;\n}): JSX.Element {\n  const token = useAppSelector(selectToken);\n  const permission = useAppSelector(selectPermission);\n  const dispatch = useAppDispatch();\n\n  return (\n    <div>\n      <h2>Einstellungen</h2>\n      <input type=\"checkbox\" checked={props.userConsent === \"granted\"} onChange={async () => {\n        await props.onClickAskUserPermission();\n        await props.onClickSusbribeToPushNotification();\n      }} />Push-Benachrichtigungen\n      <Loading loading={props.loading} />\n      <Error error={props.error} />\n      {\n        permission === \"edit\" && (\n          <>\n            <div>\n              <button onClick={props.onClickSendNotification}>Send a notification</button>\n            </div>\n          </>\n        )\n      }\n      <div>\n        Berechtigung: {permission}\n      </div>\n      <div>\n        Token: <input value={token} onChange={(evt) => dispatch(changeToken(evt.target.value))} />\n      </div>\n    </div>\n  )\n}\n\nconst Loading = ({ loading }: { loading: boolean }) => loading ? <span>Laden ...</span> : null;\nconst Error = ({ error }: { error: any }) =>\n  error ? (\n    <section className=\"app-error\">\n      <h2>{error.name}</h2>\n      <p>Error message : {error.message}</p>\n      <p>Error code : {error.code}</p>\n    </section>\n  ) : null;\n","import React, { useEffect } from \"react\";\nimport { Route, Switch } from \"react-router-dom\";\nimport { useData } from \"../api/useData\";\nimport Quests from \"./Quests\";\nimport GameHeader from \"./GameHeader\";\nimport GameFooter from \"./GameFooter\";\nimport usePushNotifications from \"../usePushNotifications\";\nimport Levels from \"./Levels\";\nimport Rewards from \"./Rewards\";\nimport Settings from \"./Settings\";\nimport \"./Game.css\";\n\nexport default function Game(props: object): JSX.Element {\n  const { data, error, loading, refetch } = useData();\n  const {\n    userConsent,\n    userSubscription,\n    onClickAskUserPermission,\n    onClickSusbribeToPushNotification,\n    onClickSendSubscriptionToPushServer,\n    onClickSendNotification,\n    loading: pushLoading,\n    error: pushError\n  } = usePushNotifications();\n\n  useEffect(() => {\n    console.log(\"update push subscription\");\n    if (userConsent === \"granted\" && userSubscription != null) onClickSendSubscriptionToPushServer();\n  }, [userConsent, userSubscription, onClickSendSubscriptionToPushServer]);\n\n  return (\n    <div className=\"game\">\n      <GameHeader data={data} />\n      <div className=\"gameMain\">\n        {loading && <>Laden ...</>}\n        {error && <>{typeof error === \"string\" ? error : JSON.stringify(error)}</>}\n        {data && (\n            <>\n              <Switch>\n                <Route path=\"/levels\" exact>\n                  <Levels levels={data.levels} />\n                </Route>\n                <Route path=\"/quests\">\n                  <Quests quests={data.quests} refetch={refetch} />\n                </Route>\n                <Route path=\"/rewards\">\n                  <Rewards refetch={refetch} />\n                </Route>\n                <Route path=\"/settings\">\n                  <Settings\n                    userConsent={userConsent}\n                    onClickAskUserPermission={onClickAskUserPermission}\n                    onClickSusbribeToPushNotification={onClickSusbribeToPushNotification}\n                    onClickSendNotification={onClickSendNotification}\n                    loading={pushLoading}\n                    error={pushError}\n                  />\n                </Route>\n              </Switch>\n            </>\n          )\n        }\n      </div>\n      <Route path=\"/\" component={GameFooter} />\n    </div>\n  );\n}\n","import Cookies from \"js-cookie\";\nimport React, { useEffect } from \"react\";\nimport Game from \"./components/Game\";\nimport { useAppDispatch } from \"./model/hooks\";\nimport { changeToken } from \"./model/permissionReducer\";\nimport \"./App.css\";\n\nexport default function App() {\n  const dispatch = useAppDispatch();\n\n  useEffect(() => {\n    const token = getPermissionTokenFromUrlOrCookie();\n    if (token != null) dispatch(changeToken(token));\n  }, [dispatch]);\n\n  return (\n    <div className=\"app\" onTouchMove={(evt) => console.log(evt)}>\n      <Game />\n    </div>\n  );\n}\n\nfunction getPermissionTokenFromUrlOrCookie(): string | undefined {\n  try {\n    const params = new URLSearchParams(window.location.search);\n    const token = params.get(\"token\") ?? Cookies.get(\"token\");\n    return token ?? undefined;\n  } catch (err) {\n    console.warn(\"Error loading the permission token from url or cookie: \", JSON.stringify(err));\n    return undefined;\n  }\n}\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport { Provider } from \"react-redux\";\nimport ReactDOM from 'react-dom';\nimport { BrowserRouter, Redirect, Route } from 'react-router-dom';\nimport store from \"./model/store\";\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport './index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <BrowserRouter>\n        <Route path=\"/\" exact component={() => <Redirect to=\"/quests\" />} />\n        <App />\n      </BrowserRouter>\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}